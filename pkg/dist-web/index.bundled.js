import e from"events";var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e,n){return e(n={exports:{}},n.exports),n.exports}var o=t(function(e,n){!function(e,n){var t=.04,o=.11;window.addEventListener("touchmove",function(){}),n.exports=function e(n){var u,c,a,s,d,f,v,l,m,h,p,y=n.source,w=void 0===y?document:y,E=n.update,g=n.multiplier,x=void 0===g?1:g,L=n.friction,b=void 0===L?.92:L,T=n.initialValues,M=n.boundX,q=n.boundY,D=n.bounce,A=void 0===D||D;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);var F=0,z=0,B=.3*x,R=!1,X=!1,Y=!1,k=!1,S=[];function C(){document.removeEventListener("touchmove",H,!!r()&&{passive:!1}),document.removeEventListener("touchend",I),document.removeEventListener("touchcancel",N),document.removeEventListener("mousemove",H,!!r()&&{passive:!1}),document.removeEventListener("mouseup",I)}function P(){E.call(w,F,z)}function O(e){if("touchmove"===e.type||"touchstart"===e.type||"touchend"===e.type){var n=e.targetTouches[0]||e.changedTouches[0];return{x:n.clientX,y:n.clientY,id:n.identifier}}return{x:e.clientX,y:e.clientY,id:null}}function j(e){var n=O(e);X||Y||(X=!0,k=!1,m=n.id,d=v=n.x,f=l=n.y,S=[],U(d,f),C(),document.addEventListener("touchmove",H,!!r()&&{passive:!1}),document.addEventListener("touchend",I),document.addEventListener("touchcancel",N),document.addEventListener("mousemove",H,!!r()&&{passive:!1}),document.addEventListener("mouseup",I))}function H(e){e.preventDefault();var n=O(e);X&&n.id===m&&(v=n.x,l=n.y,U(d,f),R||i(V),R=!0)}function I(e){var n=O(e);X&&n.id===m&&N()}function N(){X=!1,U(d,f),function(){var e=S[0],n=S[S.length-1],t=n.x-e.x,o=n.y-e.y,r=(n.time-e.time)/15/x;h=t/r||0,p=o/r||0;var u=G();(Math.abs(h)>1||Math.abs(p)>1||!u.inBounds)&&(k=!0,i(J))}(),C()}function U(e,n){for(var t=Date.now();S.length>0&&!(t-S[0].time<=100);)S.shift();S.push({x:e,y:n,time:t})}function V(){var e=v-d,n=l-f;if(F+=e*x,z+=n*x,A){var t=G();0!==t.x&&(F-=e*Z(t.x)*x),0!==t.y&&(z-=n*Z(t.y)*x)}else G(!0);P(),d=v,f=l,R=!1}function Z(e){return 5e-6*Math.pow(e,2)+1e-4*e+.55}function G(e){var n=0,t=0;return void 0!==u&&F<u?n=u-F:void 0!==c&&F>c&&(n=c-F),void 0!==a&&z<a?t=a-z:void 0!==s&&z>s&&(t=s-z),e&&(0!==n&&(F=n>0?u:c),0!==t&&(z=t>0?a:s)),{x:n,y:t,inBounds:0===n&&0===t}}function J(){if(k){F+=h*=b,z+=p*=b;var e=G();if(Math.abs(h)>B||Math.abs(p)>B||!e.inBounds){if(A){if(0!==e.x)if(e.x*h<=0)h+=e.x*t;else{var n=e.x>0?2.5:-2.5;h=(e.x+n)*o}if(0!==e.y)if(e.y*p<=0)p+=e.y*t;else{var n=e.y>0?2.5:-2.5;p=(e.y+n)*o}}else 0!==e.x&&(F=e.x>0?u:c,h=0),0!==e.y&&(z=e.y>0?a:s,p=0);P(),i(J)}else k=!1}}(function(){if(!(w="string"==typeof w?document.querySelector(w):w))throw new Error("IMPETUS: source not found.");if(!E)throw new Error("IMPETUS: update function not defined.");T&&(T[0]&&(F=T[0]),T[1]&&(z=T[1]),P()),M&&(u=M[0],c=M[1]),q&&(a=q[0],s=q[1]),w.addEventListener("touchstart",j),w.addEventListener("mousedown",j)})(),this.destroy=function(){return w.removeEventListener("touchstart",j),w.removeEventListener("mousedown",j),C(),null},this.pause=function(){C(),X=!1,Y=!0},this.resume=function(){Y=!1},this.setValues=function(e,n){"number"==typeof e&&(F=e),"number"==typeof n&&(z=n)},this.setMultiplier=function(e){B=.3*(x=e)},this.setBoundX=function(e){u=e[0],c=e[1]},this.setBoundY=function(e){a=e[0],s=e[1]}};var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};function r(){var e=!1;try{var n=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,n)}catch(e){}return r=function(){return e},e}}(0,e)}),i=function(e,n){n||(n=[0,""]),e=String(e);var t=parseFloat(e,10);return n[0]=t,n[1]=e.match(/[\d.\-\+]*\s*(.*)/)[1]||"",n},r=function e(n){if(!n)return null;if(u[n])return u[n];var t=i(n);if(!isNaN(t[0])&&t[1]){var o=e(t[1]);return"number"==typeof o?t[0]*o:null}return null},u={ch:8,ex:7.15625,em:16,rem:16,in:96,cm:96/2.54,mm:96/25.4,pt:96/72,pc:16,px:1};var c=function(e,n,t){"function"==typeof e&&(t=!!n,n=e,e=window);var o=r("ex"),i=function(e){t&&e.preventDefault();var i=e.deltaX||0,r=e.deltaY||0,u=e.deltaZ||0,c=e.deltaMode,a=1;switch(c){case 1:a=o;break;case 2:a=window.innerHeight}if(r*=a,u*=a,(i*=a)||r||u)return n(i,r,u,e)};return e.addEventListener("wheel",i),i};var a=function(e,n){var t=n[0]-e[0],o=n[1]-e[1];return Math.sqrt(t*t+o*o)};var s=function(e,n){return{configurable:!0,enumerable:!0,get:e,set:n}};var d={left:0,top:0},f=function(e,n,t){n=n||e.currentTarget||e.srcElement,Array.isArray(t)||(t=[0,0]);var o=e.clientX||0,i=e.clientY||0,r=(u=n,u===window||u===document||u===document.body?d:u.getBoundingClientRect());var u;return t[0]=o-r.left,t[1]=i-r.top,t};var v=e.EventEmitter,l=function(e){e=e||window;var n=new v,t=[null,null],o=0,i=0,r=!1,u=!1;return Object.defineProperties(n,{pinching:s(function(){return 2===o}),fingers:s(function(){return t})}),d(),n.enable=d,n.disable=function(){u&&(u=!1,o=0,t[0]=null,t[1]=null,i=0,r=!1,e.removeEventListener("touchstart",l,!1),e.removeEventListener("touchmove",h,!1),e.removeEventListener("touchend",p,!1),e.removeEventListener("touchcancel",p,!1))},n.indexOfTouch=c,n;function c(e){for(var n=e.identifier,o=0;o<t.length;o++)if(t[o]&&t[o].touch&&t[o].touch.identifier===n)return o;return-1}function d(){u||(u=!0,e.addEventListener("touchstart",l,!1),e.addEventListener("touchmove",h,!1),e.addEventListener("touchend",p,!1),e.addEventListener("touchcancel",p,!1))}function l(u){for(var a=0;a<u.changedTouches.length;a++){var s=u.changedTouches[a],d=s.identifier,v=c(d);if(-1===v&&o<2){var l=0===o,h=t[0]?1:0,p=t[0]?0:1,w=new m;t[h]=w,o++,w.touch=s,f(s,e,w.position);var E=t[p]?t[p].touch:void 0;if(n.emit("place",s,E),!l){var g=y();r=!1,n.emit("start",g),i=g}}}}function h(r){for(var u=!1,a=0;a<r.changedTouches.length;a++){var s=r.changedTouches[a],d=c(s);-1!==d&&(u=!0,t[d].touch=s,f(s,e,t[d].position))}if(2===o&&u){var v=y();n.emit("change",v,i),i=v}}function p(e){for(var i=0;i<e.changedTouches.length;i++){var u=e.changedTouches[i],a=c(u);if(-1!==a){t[a]=null,o--;var s=0===a?1:0,d=t[s]?t[s].touch:void 0;n.emit("lift",u,d)}}r||2===o||(r=!0,n.emit("end"))}function y(){return o<2?0:a(t[0].position,t[1].position)}};function m(){this.position=[0,0],this.touch=null}var h=e.EventEmitter;function p(e){var n=(e=e||{}).element||window,t=new h,o=e.position||[0,0];return!1!==e.touchstart&&(n.addEventListener("mousedown",r,!1),n.addEventListener("touchstart",i,!1)),n.addEventListener("mousemove",r,!1),n.addEventListener("touchmove",i,!1),t.position=o,t.dispose=function(){n.removeEventListener("mousemove",r,!1),n.removeEventListener("mousedown",r,!1),n.removeEventListener("touchmove",i,!1),n.removeEventListener("touchstart",i,!1)},t;function i(e){r(e.targetTouches[0])}function r(e){f(e,n,o),t.emit("move",e)}}var y=function(e){return p(e).position};y.emitter=function(e){return p(e)};for(var w=t(function(e){(function(){var n,t,o,i,r,u;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(e.exports=function(){return(n()-r)/1e6},t=process.hrtime,i=(n=function(){var e;return 1e9*(e=t())[0]+e[1]})(),u=1e9*process.uptime(),r=i-u):Date.now?(e.exports=function(){return Date.now()-o},o=Date.now()):(e.exports=function(){return(new Date).getTime()-o},o=(new Date).getTime())}).call(n)}),E="undefined"==typeof window?n:window,g=["moz","webkit"],x="AnimationFrame",L=E["request"+x],b=E["cancel"+x]||E["cancelRequest"+x],T=0;!L&&T<g.length;T++)L=E[g[T]+"Request"+x],b=E[g[T]+"Cancel"+x]||E[g[T]+"CancelRequest"+x];if(!L||!b){var M=0,q=0,D=[];L=function(e){if(0===D.length){var n=w(),t=Math.max(0,1e3/60-(n-M));M=t+n,setTimeout(function(){var e=D.slice(0);D.length=0;for(var n=0;n<e.length;n++)if(!e[n].cancelled)try{e[n].callback(M)}catch(e){setTimeout(function(){throw e},0)}},Math.round(t))}return D.push({handle:++q,callback:e,cancelled:!1}),q},b=function(e){for(var n=0;n<D.length;n++)D[n].handle===e&&(D[n].cancelled=!0)}}var A=function(e){return L.call(E,e)};A.cancel=function(){b.apply(E,arguments)},A.polyfill=function(e){e||(e=E),e.requestAnimationFrame=L,e.cancelAnimationFrame=b};export default function(e,n){e instanceof Function&&(n=e,e=document.documentElement||document.body),"string"==typeof e&&(e=document.querySelector(e));var t,i=y.emitter({element:e}),r=0,u=0,a=!0,s=e=>{a=!0};e.addEventListener("mousedown",s),e.addEventListener("touchstart",s,!1);var d=0,f=0;t=new o({source:e,update:(n,t)=>{a&&(a=!1,r=i.position[0],u=i.position[1]);var o={target:e,type:"mouse",dx:n-f,dy:t-d,dz:0,x:i.position[0],y:i.position[1],x0:r,y0:u};f=n,d=t,E(o)},multiplier:1,friction:.75});var v,m,h,p=c(e,(n,t,o,r)=>{r.preventDefault(),E({target:e,type:"mouse",dx:0,dy:0,dz:t,x:i.position[0],y:i.position[1],x0:i.position[0],y0:i.position[1]})}),w=l(e);function E(e){null==h?h=A(()=>{if(n(e),h=null,m){var t=m;m=null,E(t)}}):m?(m.dx+=e.dx,m.dy+=e.dy,m.dz+=e.dz,m.x=e.x,m.y=e.y):m=e}return w.on("start",e=>{var n=w.fingers[0],o=w.fingers[1];v=[.5*o.position[0]+.5*n.position[0],.5*o.position[1]+.5*n.position[1]],t&&t.pause()}),w.on("end",()=>{v&&(v=null,t&&t.resume())}),w.on("change",(n,t)=>{w.pinching&&v&&E({target:e,type:"touch",dx:0,dy:0,dz:2*-(n-t),x:v[0],y:v[1],x0:v[0],y0:v[0]})}),function(){i.dispose(),e instanceof HTMLElement&&(e.removeEventListener("mousedown",s),e.removeEventListener("touchstart",s),t.destroy(),e.removeEventListener("wheel",p),w.disable(),A.cancel(h))}}
