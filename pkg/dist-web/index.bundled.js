var e=require("impetus"),t=require("mouse-wheel"),n=require("touch-pinch"),o=require("touch-position"),i=require("raf"),r=require("has-passive-events");export default function(s,u){s instanceof Function&&(u=s,s=document.documentElement||document.body),"string"==typeof s&&(s=document.querySelector(s));var d,a=o.emitter({element:s}),p=0,c=0,l=!0,y=e=>{l=!0};s.addEventListener("mousedown",y),s.addEventListener("touchstart",y,!!r&&{passive:!0});var m=0,v=0;d=new e({source:s,update:(e,t)=>{l&&(l=!1,p=a.position[0],c=a.position[1]);var n={target:s,type:"mouse",dx:e-v,dy:t-m,dz:0,x:a.position[0],y:a.position[1],x0:p,y0:c};v=e,m=t,E(n)},multiplier:1,friction:.75});var x,f,h,g=t(s,(e,t,n,o)=>{o.preventDefault(),E({target:s,type:"mouse",dx:0,dy:0,dz:t,x:a.position[0],y:a.position[1],x0:a.position[0],y0:a.position[1]})}),q=n(s);function E(e){null==h?h=i(()=>{if(u(e),h=null,f){var t=f;f=null,E(t)}}):f?(f.dx+=e.dx,f.dy+=e.dy,f.dz+=e.dz,f.x=e.x,f.y=e.y):f=e}return q.on("start",e=>{var t=q.fingers[0],n=q.fingers[1];x=[.5*n.position[0]+.5*t.position[0],.5*n.position[1]+.5*t.position[1]],d&&d.pause()}),q.on("end",()=>{x&&(x=null,d&&d.resume())}),q.on("change",(e,t)=>{q.pinching&&x&&E({target:s,type:"touch",dx:0,dy:0,dz:2*-(e-t),x:x[0],y:x[1],x0:x[0],y0:x[0]})}),function(){a.dispose(),s instanceof HTMLElement&&(s.removeEventListener("mousedown",y),s.removeEventListener("touchstart",y),d.destroy(),s.removeEventListener("wheel",g),q.disable(),i.cancel(h))}}
